<mat-toolbar class="nav" data-testid="main-toolbar">
  <mat-toolbar-row data-testid="toolbar-row">
    @if (isSmallScreen()) {
      <button
        mat-icon-button
        [matMenuTriggerFor]="menu"
        data-testid="mobile-menu-toggle"
        aria-label="Open navigation menu"
      >
        <mat-icon fontSet="material-symbols-outlined">menu</mat-icon>
      </button>
      <a [routerLink]="routes.HOME">
        <span id="title" data-testid="app-title-mobile">PipSplit</span>
      </a>
      <div class="account links" data-testid="mobile-account-actions">
        <button
          matIconButton
          (click)="toggleTheme()"
          data-testid="theme-toggle-mobile"
          [aria-label]="
            themeService.currentTheme() === 'light'
              ? 'Switch to dark mode'
              : 'Switch to light mode'
          "
          [matTooltip]="
            themeService.currentTheme() === 'light'
              ? 'Switch to dark mode'
              : 'Switch to light mode'
          "
        >
          <mat-icon>
            {{
              themeService.currentTheme() === 'light'
                ? 'dark_mode'
                : 'light_mode'
            }}
          </mat-icon>
        </button>
      </div>
    }
    @if (!isSmallScreen()) {
      <a [routerLink]="routes.HOME">
        <span id="title" data-testid="app-title-desktop">PipSplit</span>
      </a>
      <div class="links" data-testid="desktop-navigation">
        @if ((isLoggedIn() && isValidUser()) || isDemoMode()) {
          <a
            matButton
            [routerLink]="routes.ADMIN_GROUPS"
            aria-label="groups"
            title="Groups"
            data-testid="nav-groups"
          >
            <mat-icon fontSet="material-symbols-outlined">groups</mat-icon
            >&nbsp;Groups
          </a>
          @if (currentGroup() != null) {
            <a
              matButton
              [routerLink]="routes.ADMIN_MEMBERS"
              aria-label="members"
              title="Members"
              data-testid="nav-members"
            >
              <mat-icon fontSet="material-symbols-outlined">face</mat-icon
              >&nbsp;Members
            </a>
            <a
              matButton
              [routerLink]="routes.ADMIN_CATEGORIES"
              aria-label="categories"
              title="Categories"
              data-testid="nav-categories"
            >
              <mat-icon fontSet="material-symbols-outlined">category</mat-icon
              >&nbsp;Categories
            </a>
            <a
              matButton
              [routerLink]="routes.EXPENSES_ROOT"
              aria-label="expenses"
              title="Expenses"
              data-testid="nav-expenses"
            >
              <mat-icon fontSet="material-symbols-outlined"
                >attach_money</mat-icon
              >Expenses
            </a>
            <a
              matButton
              [routerLink]="routes.MEMORIZED_ROOT"
              aria-label="memorized"
              title="Memorized"
              data-testid="nav-memorized"
            >
              <mat-icon fontSet="material-symbols-outlined"
                >currency_exchange</mat-icon
              >&nbsp;Memorized
            </a>
            <a
              matButton
              [routerLink]="routes.ANALYSIS_SUMMARY"
              aria-label="summary"
              title="Summary"
              data-testid="nav-summary"
            >
              <mat-icon fontSet="material-symbols-outlined"
                >compare_arrows</mat-icon
              >&nbsp;Summary
            </a>
            <a
              matButton
              [routerLink]="routes.ANALYSIS_HISTORY"
              aria-label="history"
              title="History"
              data-testid="nav-history"
            >
              <mat-icon fontSet="material-symbols-outlined">receipt</mat-icon
              >&nbsp;History
            </a>
          }
        }
        <a
          matButton
          [routerLink]="routes.SPLIT"
          aria-label="split expense"
          title="Split Expense"
          data-testid="nav-split"
        >
          <mat-icon fontSet="material-symbols-outlined">arrow_split</mat-icon
          >&nbsp;Split
        </a>
      </div>
      <div class="account links" data-testid="desktop-account-actions">
        <button
          matIconButton
          (click)="toggleTheme()"
          data-testid="theme-toggle-desktop"
          [aria-label]="
            themeService.currentTheme() === 'light'
              ? 'Switch to dark mode'
              : 'Switch to light mode'
          "
          [matTooltip]="
            themeService.currentTheme() === 'light'
              ? 'Switch to dark mode'
              : 'Switch to light mode'
          "
        >
          <mat-icon>
            {{
              themeService.currentTheme() === 'light'
                ? 'dark_mode'
                : 'light_mode'
            }}
          </mat-icon>
        </button>
        <a
          matIconButton
          [routerLink]="['help']"
          matTooltip="Help"
          aria-label="help"
          data-testid="nav-help-desktop"
        >
          <mat-icon>help</mat-icon>
        </a>
        @if (isLoggedIn() && !isDemoMode()) {
          <a
            matIconButton
            [routerLink]="['auth', 'account']"
            matTooltip="Account"
            aria-label="account"
            data-testid="nav-account-desktop"
          >
            <mat-icon>account_circle</mat-icon>
          </a>
          <button
            matIconButton
            (click)="logout()"
            aria-label="log out"
            matTooltip="Log out"
            data-testid="logout-button-desktop"
          >
            <mat-icon>logout</mat-icon>
          </button>
        } @else {
          <a
            matButton
            [routerLink]="['auth', 'login']"
            aria-label="login"
            matTooltip="Login"
            data-testid="nav-login-desktop"
          >
            <mat-icon>login</mat-icon>
            &nbsp;<span>Log in</span>
          </a>
        }
      </div>
    }
  </mat-toolbar-row>
</mat-toolbar>

<mat-menu #menu="matMenu" data-testid="mobile-menu">
  <div class="menu" data-testid="mobile-menu-content">
    @if ((isLoggedIn() && isValidUser()) || isDemoMode()) {
      <a
        mat-menu-item
        [routerLink]="routes.ADMIN_GROUPS"
        aria-label="groups"
        title="Groups"
        data-testid="mobile-nav-groups"
      >
        <mat-icon fontSet="material-symbols-outlined">groups</mat-icon
        >&nbsp;Groups
      </a>
      @if (currentGroup() != null) {
        <a
          mat-menu-item
          [routerLink]="routes.ADMIN_MEMBERS"
          aria-label="members"
          title="Members"
          data-testid="mobile-nav-members"
        >
          <mat-icon fontSet="material-symbols-outlined">face</mat-icon
          >&nbsp;Members
        </a>
        <a
          mat-menu-item
          [routerLink]="routes.ADMIN_CATEGORIES"
          aria-label="categories"
          title="Categories"
          data-testid="mobile-nav-categories"
        >
          <mat-icon fontSet="material-symbols-outlined">category</mat-icon
          >&nbsp;Categories
        </a>
        <a
          mat-menu-item
          [routerLink]="routes.EXPENSES_ROOT"
          aria-label="expenses"
          title="Expenses"
          data-testid="mobile-nav-expenses"
        >
          <mat-icon fontSet="material-symbols-outlined">attach_money</mat-icon
          >Expenses
        </a>
        <a
          mat-menu-item
          [routerLink]="routes.MEMORIZED_ROOT"
          aria-label="memorized"
          title="Memorized"
          data-testid="mobile-nav-memorized"
        >
          <mat-icon fontSet="material-symbols-outlined"
            >currency_exchange</mat-icon
          >&nbsp;Memorized
        </a>
        <a
          mat-menu-item
          [routerLink]="routes.ANALYSIS_SUMMARY"
          aria-label="summary"
          title="Summary"
          data-testid="mobile-nav-summary"
        >
          <mat-icon fontSet="material-symbols-outlined">compare_arrows</mat-icon
          >&nbsp;Summary
        </a>
        <a
          mat-menu-item
          [routerLink]="routes.ANALYSIS_HISTORY"
          aria-label="history"
          title="History"
          data-testid="mobile-nav-history"
        >
          <mat-icon fontSet="material-symbols-outlined">receipt</mat-icon
          >&nbsp;History
        </a>
        <a
          mat-menu-item
          [routerLink]="routes.SPLIT"
          aria-label="split expense"
          title="Split expense"
          data-testid="mobile-nav-split"
        >
          <mat-icon fontSet="material-symbols-outlined">arrow_split</mat-icon
          >&nbsp;Split
        </a>
      }
      <a
        mat-menu-item
        [routerLink]="routes.HELP"
        aria-label="help"
        title="Help"
        data-testid="mobile-nav-help"
      >
        <mat-icon fontSet="material-symbols-outlined">help</mat-icon>&nbsp;Help
      </a>
      @if (isLoggedIn() && !isDemoMode()) {
        <a
          mat-menu-item
          [routerLink]="routes.AUTH_ACCOUNT"
          aria-label="account"
          title="Account"
          data-testid="mobile-nav-account"
        >
          <mat-icon fontSet="material-symbols-outlined">account_circle</mat-icon
          >&nbsp;Account
        </a>
        <a
          mat-menu-item
          (click)="logout()"
          aria-label="log out"
          title="Log out"
          data-testid="mobile-logout-button"
        >
          <mat-icon fontSet="material-symbols-outlined">logout</mat-icon
          >&nbsp;Log out
        </a>
      } @else {
        <a
          mat-menu-item
          [routerLink]="routes.AUTH_LOGIN"
          aria-label="login"
          title="Login"
          data-testid="mobile-nav-login"
        >
          <mat-icon fontSet="material-symbols-outlined">login</mat-icon
          >&nbsp;Log in
        </a>
      }
    }
  </div>
</mat-menu>
<loading data-testid="loading-component" />
<div id="outlet" data-testid="main-content">
  <router-outlet />
</div>
<footer data-testid="main-footer"></footer>
