<div class="d-flex flex-column p-2">
  <div class="d-flex pt-2 justify-content-center align-items-center">
    <h3>{{ currentGroup()?.name }}</h3>
  </div>
  <div class="d-flex p-2 justify-content-center align-items-center">
    <mat-form-field id="group-select" color="primary">
      <mat-label>Select Member</mat-label>
      <mat-select
        [(ngModel)]="selectedMemberId"
        name="member"
        (selectionChange)="onSelectMember()"
      >
        @for (member of activeMembers(); track member) {
          <mat-option [value]="member.id">{{ member.displayName }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>
  <div class="d-flex p-2 justify-content-center align-items-center">
    <mat-form-field appearance="fill" class="datepicker me-2">
      <mat-label>Start date</mat-label>
      <input
        matInput
        [(ngModel)]="startDate"
        [matDatepicker]="startDatepicker"
        (dateChange)="loadUnpaidSplits()"
      />
      <mat-hint>MM/DD/YYYY</mat-hint>
      <mat-datepicker-toggle
        matIconSuffix
        [for]="startDatepicker"
      ></mat-datepicker-toggle>
      <button
        *ngIf="startDate"
        matSuffix
        mat-icon-button
        aria-label="Clear"
        (click)="clearStartDate()"
      >
        <mat-icon>close</mat-icon>
      </button>
      <mat-datepicker #startDatepicker></mat-datepicker>
    </mat-form-field>
    <mat-form-field appearance="fill" class="datepicker me-2">
      <mat-label>End date</mat-label>
      <input
        matInput
        [(ngModel)]="endDate"
        [matDatepicker]="endDatePicker"
        (dateChange)="loadUnpaidSplits()"
      />
      <mat-hint>MM/DD/YYYY</mat-hint>
      <mat-datepicker-toggle
        matIconSuffix
        [for]="endDatePicker"
      ></mat-datepicker-toggle>
      <button
        *ngIf="endDate"
        matSuffix
        mat-icon-button
        aria-label="Clear"
        (click)="clearEndDate()"
      >
        <mat-icon>close</mat-icon>
      </button>
      <mat-datepicker #endDatePicker></mat-datepicker>
    </mat-form-field>
  </div>
  <div class="d-flex justify-content-center">
    <div class="scrollable-table mat-elevation-z8">
      <table mat-table [dataSource]="summaryData">
        <ng-container matColumnDef="owedTo">
          <th mat-header-cell *matHeaderCellDef>Owed To</th>
          <td mat-cell *matCellDef="let amountDue">
            {{ getMemberName(amountDue.owedToMemberId) }}
          </td>
        </ng-container>
        <ng-container matColumnDef="owedBy">
          <th mat-header-cell *matHeaderCellDef>Owed By</th>
          <td mat-cell *matCellDef="let amountDue">
            {{ getMemberName(amountDue.owedByMemberId) }}
          </td>
        </ng-container>
        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef class="cell-right">Amount</th>
          <td mat-cell *matCellDef="let amountDue" class="cell-right">
            {{ amountDue.amount | currency }}
          </td>
        </ng-container>
        <ng-container matColumnDef="markPaid">
          <th mat-header-cell *matHeaderCellDef>Mark Paid</th>
          <td mat-cell *matCellDef="let amountDue" class="cell-center">
            <button
              mat-mini-fab
              class="btn btn-success"
              (click)="
                markExpensesPaid(
                  amountDue.owedToMemberId,
                  amountDue.owedByMemberId
                )
              "
            >
              <mat-icon>paid</mat-icon>
            </button>
          </td>
        </ng-container>
        <tr
          mat-header-row
          *matHeaderRowDef="summaryColumnsToDisplay; sticky: true"
        ></tr>
        <tr
          mat-row
          *matRowDef="let amountDue; columns: summaryColumnsToDisplay"
          class="clickable-row"
          (click)="
            onRowSelect(amountDue.owedToMemberId, amountDue.owedByMemberId)
          "
        ></tr>
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" [colSpan]="summaryColumnsToDisplay.length">
            No outstanding expenses found for selected member.
          </td>
        </tr>
      </table>
    </div>
  </div>
  <div *ngIf="summaryData.length > 0" class="d-flex justify-content-center">
    <div class="scrollable-table mat-elevation-z8">
      <table mat-table [dataSource]="detailData">
        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef>Category</th>
          <td mat-cell *matCellDef="let amountDue">
            {{ getCategoryName(amountDue.categoryId) }}
          </td>
        </ng-container>
        <ng-container matColumnDef="amount">
          <th mat-header-cell *matHeaderCellDef class="cell-right">Amount</th>
          <td mat-cell *matCellDef="let amountDue" class="cell-right">
            {{ amountDue.amount | currency }}
          </td>
        </ng-container>
        <tr
          mat-header-row
          *matHeaderRowDef="detailColumnsToDisplay; sticky: true"
        ></tr>
        <tr
          mat-row
          *matRowDef="let amountDue; columns: detailColumnsToDisplay"
        ></tr>
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" [colSpan]="detailColumnsToDisplay.length">
            Click a row above to view details.
          </td>
        </tr>
      </table>
    </div>
  </div>
</div>
