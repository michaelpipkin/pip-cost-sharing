<div class="container" data-testid="reset-password-container">
  <h2 data-testid="reset-password-title">Reset Password</h2>
  <form
    [formGroup]="resetPasswordForm"
    class="reset-form"
    (submit)="resetPassword()"
    data-testid="reset-password-form"
    aria-label="Reset password form"
  >
    <mat-form-field data-testid="new-password-field">
      <mat-label>Password</mat-label>
      <input
        matInput
        [type]="hidePassword() ? 'password' : 'text'"
        formControlName="password"
        data-testid="new-password-input"
        aria-label="Enter new password"
      />
      <button
        mat-icon-button
        type="button"
        matIconSuffix
        (click)="toggleHidePassword()"
        [attr.aria-label]="'Hide password'"
        [attr.aria-pressed]="hidePassword"
        tabindex="-1"
        data-testid="toggle-password-visibility"
      >
        <mat-icon fontSet="material-symbols-outlined">{{
          hidePassword() ? 'visibility_off' : 'visibility'
        }}</mat-icon>
      </button>
    </mat-form-field>
    <mat-form-field data-testid="confirm-password-field">
      <mat-label>Confirm Password</mat-label>
      <input
        matInput
        [type]="hideConfirmPassword() ? 'password' : 'text'"
        formControlName="confirmPassword"
        data-testid="confirm-password-input"
        aria-label="Confirm new password"
      />
      <button
        mat-icon-button
        type="button"
        matIconSuffix
        (click)="toggleHideConfirmPassword()"
        [attr.aria-label]="'Hide password'"
        [attr.aria-pressed]="hideConfirmPassword"
        tabindex="-1"
        data-testid="toggle-confirm-password-visibility"
      >
        <mat-icon fontSet="material-symbols-outlined">{{
          hideConfirmPassword() ? 'visibility_off' : 'visibility'
        }}</mat-icon>
      </button>
    </mat-form-field>
    @if (
      resetPasswordForm.errors?.passwordMismatch && r.confirmPassword.touched
    ) {
      <div class="form-error" data-testid="password-mismatch-error">Passwords do not match.</div>
    }
    <div class="buttons" data-testid="reset-password-buttons">
      <button
        mat-raised-button
        class="btn-primary mb-3"
        type="submit"
        [disabled]="resetPasswordForm.invalid || resetPasswordForm.pristine"
        data-testid="reset-password-submit"
        aria-label="Submit new password"
      >
        <span class="reset-button">Submit</span>
      </button>
      <a class="primary-link" routerLink="../login" data-testid="return-to-login-link" aria-label="Return to login page">Return to Login</a>
    </div>
  </form>
</div>
