<div class="container" data-testid="register-container">
  <h2 data-testid="register-title">Create Account</h2>
  <form
    [formGroup]="registerForm"
    class="register"
    (submit)="register()"
    data-testid="register-form"
    aria-label="Create account form"
  >
    <mat-form-field data-testid="register-email-field">
      <mat-label>Email</mat-label>
      <input
        matInput
        type="email"
        formControlName="email"
        data-testid="register-email-input"
        aria-label="Email address"
      />
      @if (r.email.errors?.required) {
        <mat-error>Email is required.</mat-error>
      }
      @if (r.email.errors?.email) {
        <mat-error>Invalid email address.</mat-error>
      }
    </mat-form-field>
    <mat-form-field>
      <mat-label>Password</mat-label>
      <input
        matInput
        [type]="hidePassword() ? 'password' : 'text'"
        formControlName="password"
      />
      <button
        mat-icon-button
        type="button"
        matIconSuffix
        (click)="toggleHidePassword()"
        [attr.aria-label]="'Hide password'"
        [attr.aria-pressed]="hidePassword()"
        tabindex="-1"
      >
        <mat-icon fontSet="material-symbols-outlined">{{
          hidePassword() ? 'visibility_off' : 'visibility'
        }}</mat-icon>
      </button>
    </mat-form-field>
    <mat-form-field>
      <mat-label>Confirm Password</mat-label>
      <input
        matInput
        [type]="hideConfirmPassword() ? 'password' : 'text'"
        formControlName="confirmPassword"
      />
      <button
        mat-icon-button
        type="button"
        matIconSuffix
        (click)="toggleHideConfirmPassword()"
        [attr.aria-label]="'Hide password'"
        [attr.aria-pressed]="hideConfirmPassword()"
        tabindex="-1"
      >
        <mat-icon fontSet="material-symbols-outlined">{{
          hideConfirmPassword() ? 'visibility_off' : 'visibility'
        }}</mat-icon>
      </button>
    </mat-form-field>
    @if (registerForm.errors?.passwordMismatch && r.confirmPassword.touched) {
      <div class="form-error">Passwords do not match.</div>
    }
    <div id="hcaptcha-container"></div>
    <p
      class="privacy-notice"
      style="
        font-size: 0.875rem;
        text-align: center;
        margin: 10px 0;
        color: #666;
      "
    >
      By registering, you agree to our
      <a
        href="/privacy-policy.html"
        target="_blank"
        (click)="openPrivacyPolicy($event)"
        style="color: #4caf50; text-decoration: none"
        >Privacy Policy</a
      >
    </p>
    <div class="buttons">
      <button
        mat-raised-button
        class="btn-primary"
        type="submit"
        [disabled]="
          registerForm.invalid || registerForm.pristine || !passedCaptcha()
        "
      >
        <span class="register-button">Register</span>
      </button>
      <a class="primary-link" routerLink="../login">Return to Login</a>
    </div>
  </form>
  <mat-divider class="standard-divider"></mat-divider>
  <div class="platform-message" data-testid="platform-message">
    @if (isRunningInBrowser()) {
      <div class="app-download-section" data-testid="app-download">
        <p class="mb-0" data-testid="download-message">
          <strong>Get the PipSplit app!</strong>
        </p>
        <a
          href="https://play.google.com/store/apps/details?id=com.pipsplit.app"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Get PipSplit on Google Play"
          data-testid="google-play-badge"
        >
          <img
            src="/assets/images/google-play-badge.png"
            alt="Get it on Google Play"
            class="play-store-badge"
            data-testid="play-store-image"
          />
        </a>
      </div>
    }
    @if (isRunningAsApp()) {
      <div class="web-visit-section" data-testid="web-visit">
        <p data-testid="web-visit-message">
          <strong>Visit PipSplit on the web at pipsplit.com</strong>
        </p>
      </div>
    }
  </div>
</div>
