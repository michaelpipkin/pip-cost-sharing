<h1 mat-dialog-title data-testid="manage-groups-title">Manage Groups</h1>
<mat-dialog-content>
  @if (userAdminGroups().length === 0) {
    <p>You are not an admin of any groups.</p>
  } @else {
    <form [formGroup]="editGroupForm">
      <div class="content pt-3">
        <mat-form-field id="group-select">
          <mat-label>Select Group</mat-label>
          <mat-select
            data-testid="manage-group-select"
            formControlName="groupRef"
            name="group"
            (selectionChange)="onSelectGroup()"
            docRefCompare
          >
            @for (group of userAdminGroups(); track group.ref) {
              <mat-option
                [value]="group.ref"
                [attr.data-testid]="'manage-group-option-' + group.id"
                >{{ group.name }}
                @if (group.archived) {
                  (Archived)
                }
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
        @if (!!selectedGroup()) {
          <mat-form-field appearance="fill">
            <mat-label>Update group name</mat-label>
            <input
              matInput
              formControlName="groupName"
              data-testid="manage-group-name-input"
            />
            @if (f.groupName.errors?.['required']) {
              <mat-error> *Required </mat-error>
            }
          </mat-form-field>
          <mat-form-field appearance="fill" class="mb-4">
            <mat-label>Currency</mat-label>
            <mat-select
              formControlName="currencyCode"
              data-testid="manage-currency-select"
            >
              @for (currency of supportedCurrencies; track currency.code) {
                @if (currency.symbolPosition === 'none') {
                  <mat-option [value]="currency.code">
                    {{ currency.name }}
                  </mat-option>
                } @else {
                  <mat-option [value]="currency.code">
                    {{ currency.symbol }} - {{ currency.name }} ({{
                      currency.code
                    }})
                  </mat-option>
                }
              }
            </mat-select>
            @if (f.currencyCode.errors?.['required']) {
              <mat-error> *Required </mat-error>
            }
            @if (groupHasExpenses()) {
              <mat-hint
                >Cannot be changed once expenses are added to the
                group</mat-hint
              >
            } @else {
              <mat-hint>Select the currency for this group</mat-hint>
            }
          </mat-form-field>
          <div class="toggle">
            <mat-slide-toggle
              formControlName="active"
              data-testid="manage-active-toggle"
              >Active</mat-slide-toggle
            >
          </div>
          <div class="toggle">
            <mat-slide-toggle
              formControlName="autoAddMembers"
              data-testid="manage-auto-add-toggle"
              >Automatically add all group<br />
              members to new expenses</mat-slide-toggle
            >
          </div>
        }
      </div>
    </form>
  }
</mat-dialog-content>
<mat-dialog-actions class="action-buttons">
  @if (!!selectedGroup()) {
    <div class="full-width-btn">
      @if (selectedGroup()?.archived) {
        <button
          data-testid="unarchive-group-button"
          mat-raised-button
          class="btn-tertiary full-width-btn"
          type="button"
          (click)="unarchiveGroup()"
          [disabled]="editGroupForm.disabled"
        >
          Unarchive Group
        </button>
      } @else {
        <button
          data-testid="archive-group-button"
          mat-raised-button
          class="btn-danger full-width-btn"
          type="button"
          (click)="archiveGroup()"
          [disabled]="editGroupForm.disabled"
        >
          Archive Group
        </button>
      }
    </div>
    <div class="full-width-btn">
      <button
        data-testid="delete-group-button"
        mat-raised-button
        class="btn-danger full-width-btn"
        type="button"
        (click)="deleteGroup()"
        [disabled]="editGroupForm.disabled"
      >
        Delete Group
      </button>
    </div>
  }
  <div class="standard-actions">
    @if (userAdminGroups().length === 0) {
      <button
        data-testid="manage-groups-close-button"
        mat-stroked-button
        type="button"
        [mat-dialog-close]="false"
        [disabled]="editGroupForm.disabled"
      >
        Close
      </button>
    } @else {
      <button
        data-testid="manage-groups-save-button"
        mat-raised-button
        class="btn-secondary"
        type="submit"
        defaultButton
        [disabled]="
          !editGroupForm.valid ||
          editGroupForm.pristine ||
          editGroupForm.disabled
        "
        (click)="onSubmit()"
      >
        Save
      </button>
      <button
        data-testid="manage-groups-cancel-button"
        mat-stroked-button
        type="button"
        [mat-dialog-close]="false"
        [disabled]="editGroupForm.disabled"
      >
        Cancel
      </button>
    }
  </div>
</mat-dialog-actions>
