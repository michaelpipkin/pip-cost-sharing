# Android TWA (Trusted Web Activity) Implementation Guide

## Overview
Converting PipSplit PWA to an Android app using Google's Trusted Web Activity (TWA) approach via Bubblewrap.

## Current Status
- ✅ PWA manifest.json exists and is well-configured
- ✅ App works perfectly as installed PWA on Android
- ✅ Icons available (192x192, 512x512)
- ✅ No service worker (online-only by design)

## Implementation Steps

### 1. Optimize PWA Manifest (COMPLETED)
**Status:** Reviewed - manifest is good but could use minor enhancements

**Current manifest.json:**
```json
{
  "name": "PipSplit",
  "short_name": "PipSplit",
  "description": "Split expenses and track shared costs easily",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#4caf50",
  "icons": [...]
}
```

**Optional Enhancements:**
- Add `orientation` field for mobile optimization
- Add `categories` for Play Store classification
- Add `screenshots` for richer install prompt

### 2. Install Bubblewrap CLI (PENDING)
**What:** Bubblewrap is Google's official tool for generating TWAs

**Prerequisites:**
- Node.js (already installed via pnpm)
- JDK 17+ (required for Android builds)
- Android SDK (Bubblewrap can install if needed)

**Installation:**
```bash
npm install -g @bubblewrap/cli
```

**First-time setup:**
```bash
bubblewrap doctor
```
This will check dependencies and offer to install missing components.

### 3. Initialize TWA Project (PENDING)
**What:** Generate the Android project wrapper for your PWA

```bash
bubblewrap init --manifest https://pipsplit.com/manifest.json
```

**Interactive prompts will ask for:**
- App name: PipSplit
- Package name: com.pipsplit.app (or your preference)
- Host: pipsplit.com
- Start URL: /
- Icon URLs: Will pull from manifest
- Theme color: #4caf50 (from manifest)
- Background color: #ffffff (from manifest)
- Enable notifications: No (unless you want push notifications)
- Fallback strategy: Keep current page (recommended for online-only app)
- Display mode: standalone

**Output:** Creates a `twa-project` folder with Android project files

### 4. Configure Signing Keys (PENDING)
**What:** Create signing keys for Play Store deployment

**For development/testing (auto-generated):**
Bubblewrap creates a debug key automatically.

**For Play Store release:**
```bash
# Generate upload key
keytool -genkey -v -keystore upload-keystore.jks -keyalg RSA -keysize 2048 -validity 10000 -alias upload
```

**Important:**
- Store keystore file securely (NOT in git)
- Save keystore password
- Save key alias and password
- You'll need these for every release

**Add to .gitignore:**
```
*.jks
*.keystore
key.properties
```

### 5. Build APK for Testing (PENDING)
**What:** Build a debug APK to test on your device

```bash
cd twa-project
bubblewrap build
```

**Output:** Generates `app-release-signed.apk`

**Test locally:**
- Install on Android device via ADB or file transfer
- Test all functionality
- Verify no browser chrome appears
- Test deep linking
- Verify icon and splash screen

### 6. Build AAB for Play Store (PENDING)
**What:** Generate Android App Bundle for Play Store submission

```bash
bubblewrap build --appBundle
```

**Output:** Generates `app-release-bundle.aab`

### 7. Play Store Submission Requirements (PENDING)
**What you'll need:**
- [x] Developer account ($25 one-time fee) - in progress
- [ ] App icon: 512x512 (you have this)
- [ ] Feature graphic: 1024x500
- [ ] Screenshots: 2-8 images (minimum 2)
  - Phone screenshots (16:9 or 9:16)
  - Tablet screenshots optional but recommended
- [ ] Privacy policy URL (required if app collects data)
- [ ] App description
- [ ] Content rating questionnaire
- [ ] Target audience

**Screenshot recommendations:**
- Show key features: expense creation, group management, summary view
- Use actual app screenshots from Android device
- Consider using Android device frames for professional look

## Configuration Files

### bubblewrap.config.json (Generated)
Located in `twa-project/` after initialization. Key fields:
```json
{
  "packageId": "com.pipsplit.app",
  "host": "pipsplit.com",
  "name": "PipSplit",
  "launcherName": "PipSplit",
  "display": "standalone",
  "themeColor": "#4caf50",
  "backgroundColor": "#ffffff",
  "startUrl": "/",
  "iconUrl": "https://pipsplit.com/assets/images/pip_split_icon_512x512.png",
  "maskableIconUrl": "https://pipsplit.com/assets/images/pip_split_icon_512x512.png"
}
```

## Digital Asset Links (Critical)

**What:** Verifies you own both the website and Android app

**Required file:** `src/.well-known/assetlinks.json`

**Generated by Bubblewrap** but must be hosted at:
`https://pipsplit.com/.well-known/assetlinks.json`

**Example content:**
```json
[{
  "relation": ["delegate_permission/common.handle_all_urls"],
  "target": {
    "namespace": "android_app",
    "package_name": "com.pipsplit.app",
    "sha256_cert_fingerprints": ["AA:BB:CC:..."]
  }
}]
```

**Deployment:**
- Add `.well-known` folder to `src/`
- Update `angular.json` to include in assets
- Deploy to production
- Verify accessible at URL above

## Maintenance & Updates

**Good news:** Updates are automatic!
- When you update your web app, users get updates instantly
- No need to rebuild/resubmit APK for content changes
- Only rebuild if you change:
  - Package name
  - App icons
  - Splash screen
  - TWA configuration

## Testing Checklist

- [ ] App installs without errors
- [ ] No browser UI (address bar, etc.) visible
- [ ] App icon appears in launcher
- [ ] Splash screen displays on launch
- [ ] All Firebase features work (auth, Firestore)
- [ ] Deep links work correctly
- [ ] Back button behavior is appropriate
- [ ] Status bar color matches theme
- [ ] App appears in Android app settings
- [ ] App can be uninstalled properly

## Troubleshooting

### Digital Asset Links not verified
- Check assetlinks.json is accessible
- Verify SHA256 fingerprint matches keystore
- Allow 24-48 hours for Google to verify
- Use `adb logcat` to see verification errors

### App opens in Chrome browser instead of TWA
- Digital Asset Links not verified yet
- Wrong SHA256 fingerprint in assetlinks.json
- Package name mismatch

### Build failures
- Check JDK version (need 17+)
- Verify Android SDK installed
- Run `bubblewrap doctor` to diagnose

## COMPLETED STEPS

✅ **Prerequisites installed:**
- Node.js v22.12.0
- JDK 17 (via junction at C:\jdk17)
- Bubblewrap CLI v1.24.1

✅ **TWA Project created:**
- Location: `C:\Users\mpipk\source\repos\michaelpipkin\pipsplit-twa\`
- Package ID: `com.pipsplit.app`
- Keystore: `android.keystore` (password: android123 - **CHANGE FOR PRODUCTION**)

✅ **Production Build successful:**
- APK: `app-release-signed.apk` (signed with production keystore)
- AAB: `app-release-bundle.aab` (ready for Play Store)
- Production Keystore: `production.keystore` (alias: upload)
- SHA256 Fingerprint: `5B:CD:50:5E:7D:3F:5D:E2:3E:08:9A:7D:C4:13:DB:2E:2C:B8:A8:8A:BB:FA:FC:D2:DE:E8:68:05:CA:E9:82:A5`

✅ **Digital Asset Links deployed:**
- File: `src/.well-known/assetlinks.json`
- Accessible at: https://pipsplit.com/.well-known/assetlinks.json
- Contains production keystore fingerprint
- **READY FOR PLAY STORE SUBMISSION!**

## Deployment Instructions

1. **Build and deploy your web app:**
   ```bash
   cd pip-cost-sharing
   pnpm build:prod
   # Deploy to Firebase
   ```

2. **Verify assetlinks.json is accessible:**
   After deployment, check: `https://pipsplit.com/.well-known/assetlinks.json`

   It should return the JSON file with your package name and SHA256 fingerprint.

3. **Test the APK on your Android device:**
   - Transfer `app-release-signed.apk` to your phone
   - Install it (you may need to enable "Install from Unknown Sources")
   - Open the app
   - First time: May open in Chrome (Digital Asset Links not verified yet)
   - After 24-48 hours: Should open as full-screen app (once Google verifies)

4. **Upload AAB to Play Store Console:**
   - Go to Google Play Console
   - Create new app
   - Upload `app-release-bundle.aab`
   - Fill out store listing
   - Submit for review

## Play Store Submission Checklist

### Required Materials

You'll need to prepare the following for Play Store submission:

1. **App Bundle (AAB)** ✅
   - Location: `C:\Users\mpipk\source\repos\michaelpipkin\pipsplit-twa\app-release-bundle.aab`
   - Ready to upload!

2. **App Icon** ✅
   - 512x512 PNG (you already have this at `src/assets/images/pip_split_icon_512x512.png`)

3. **Feature Graphic** ⏳
   - Required size: 1024w x 500h pixels
   - Should showcase your app's key feature
   - No rounded corners, no transparency

4. **Screenshots** ⏳
   - Minimum 2 screenshots required
   - Recommended: 4-8 screenshots
   - Phone: 16:9 or 9:16 aspect ratio
   - Minimum dimension: 320px
   - Maximum dimension: 3840px
   - Take screenshots showing:
     - Creating/joining a group
     - Adding an expense
     - Viewing expense summary
     - Settling up payments

5. **Privacy Policy** ⏳
   - Required URL (if app collects any user data)
   - Must be hosted and publicly accessible
   - Should explain what data you collect (Firebase Auth, Firestore data, etc.)

6. **App Information** ⏳
   - Short description (80 characters max)
   - Full description (4000 characters max)
   - App category: Finance or Productivity
   - Content rating: Complete questionnaire in Play Console
   - Target audience: Adults

### Recommended Descriptions

**Short Description (example):**
"Split expenses and track shared costs with unlimited groups. Perfect for roommates and group trips."

**Full Description (example):**
```
PipSplit helps you effortlessly track and split shared expenses with friends, roommates, and travel companions.

KEY FEATURES:
• Create unlimited expense groups
• Add expenses and specify who paid and who owes
• Automatic expense splitting calculations
• Detailed payment summaries
• Track who owes what to whom
• Settle up and mark payments as complete
• Real-time sync across all devices

PERFECT FOR:
• Roommates sharing rent and utilities
• Friends splitting dinner bills
• Group trips and vacations
• Shared household expenses
• Any situation involving shared costs

PipSplit makes it easy to keep track of shared expenses without the awkward conversations. No more spreadsheets or mental math - just simple, transparent expense tracking.

FREE TO USE with unlimited groups and expenses!
```

### Step-by-Step Play Store Submission

1. **Go to Google Play Console**: https://play.google.com/console
2. **Create New App**:
   - App name: PipSplit
   - Default language: English (United States)
   - App type: App
   - Free or Paid: Free
3. **Store Listing**:
   - Upload app icon, feature graphic, screenshots
   - Enter descriptions
   - Add privacy policy URL
4. **Content Rating**:
   - Complete the questionnaire
   - Most likely rating: Everyone
5. **Target Audience**:
   - Select age groups
6. **Store Presence**:
   - Select countries/regions (start with US, expand later)
7. **Production Release**:
   - Create new release
   - Upload `app-release-bundle.aab`
   - Release name: 1.11.25 (or your version)
   - Release notes: "Initial release of PipSplit for Android"
   - Save and submit for review

### Review Timeline
- Initial review: 1-7 days (typically 1-3 days)
- Google will email you when approved or if issues found

## Next Steps After Play Store Approval

1. **Add Play Store badge to website:**
   ```html
   <a href="https://play.google.com/store/apps/details?id=com.pipsplit.app">
     <img src="google-play-badge.png" alt="Get it on Google Play">
   </a>
   ```

2. **Consider iOS PWA:**
   - iOS doesn't have TWA equivalent
   - Users can still "Add to Home Screen"
   - Or explore Capacitor for iOS App Store distribution

3. **Monitor Play Store Console:**
   - Check crash reports
   - Monitor user reviews
   - Track installation analytics

## Estimated Timeline

- **Setup & Configuration:** 2-3 hours
- **Testing & Refinement:** 2-4 hours
- **Play Store Submission:** 1-2 hours
- **Google Review Process:** 1-7 days (typically 1-3 days)

## Resources

- [Bubblewrap Documentation](https://github.com/GoogleChromeLabs/bubblewrap)
- [TWA Best Practices](https://developer.chrome.com/docs/android/trusted-web-activity/)
- [Play Store Listing Guide](https://play.google.com/console/about/guides/releasewithconfidence/)
- [PWA Manifest Spec](https://web.dev/add-manifest/)
